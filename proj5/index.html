<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<style>
  body {
    padding: 100px;
    width: 1000px;
    margin: auto;
    text-align: left;
    font-weight: 300;
    font-family: 'Open Sans', sans-serif;
    color: #121212;
  }
  h1, h2, h3, h4 {
    font-family: 'Source Sans Pro', sans-serif;
  }
</style>
<title>NeRF - Neural Radiance Fields</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Sans+Pro" rel="stylesheet">
</head>


<body>

<h1 align="middle">CS 180: Intro to Computer Vision and Computational Photography, Fa2023</h1>
<h1 align="middle">Project 5: Neural Radiance Fields</h1>
<h2 align="middle">ANTHONY ZHANG, 3036218223</h2>

<br><br>

<div>

<h2 align="middle">Part 1: Fitting an Image Network</h2>
<p>
  To learn the Image function with a neural network, I used the network described in the spec. The architecture is pictured below:
</p>
<div align="middle">
  <table style="width=100%">
  <tr>
      <td>
      <img src="images/image-arch.png" align="middle" width="750px"/>
      <figcaption align="middle">Model Architecture</figcaption>
      </td>
  </tr>
  </table>
</div>
<p> 
  I trained the network for 1500 iterations with a batch size of 10k, and backpropped the model with the Adam optimizer. 
  I experimented with the hyperparameters L (the number of frequency levels for the positional encoder) and the learning rate.
  Pictured below are the results of my model pictured from iterations [1, 10, 50, 100, 150, 200, 300, 500, 1000, 1500]
</p> 
<div align="middle">
  <table style="width=100%">
    <tr>
        <td>
        <img src="images/fox1.png" align="middle" width="700px"/>
        <figcaption align="middle">Learning Rate: 1e-2 , Number of Frequency Levels: 20</figcaption>
        </td>
        <td>
          <img src="images/bestfox.png" align="middle" width="300px"/>
          <figcaption align="middle">Final Iteration Produced</figcaption>
        </td>
    </tr>
    <tr>
      <td>
      <img src="images/fox2.png" align="middle" width="700px"/>
      <figcaption align="middle">Learning Rate: 1e-2 , Number of Frequency Levels: 5</figcaption>
      </td>
      <td>
        <img src="images/bestfox2.png" align="middle" width="300px"/>
        <figcaption align="middle">Final Iteration Produced</figcaption>
      </td>
    </tr>
    <tr>
      <td>
      <img src="images/fox3.png" align="middle" width="700px"/>
      <figcaption align="middle">Learning Rate: 1e-4 , Number of Frequency Levels: 20</figcaption>
      </td>
      <td>
        <img src="images/bestfox3.png" align="middle" width="300px"/>
        <figcaption align="middle">Final Iteration Produced</figcaption>
      </td>
    </tr>
    <tr>
      <td>
      <img src="images/fox4.png" align="middle" width="700px"/>
      <figcaption align="middle">Learning Rate: 1e-4 , Number of Frequency Levels: 5</figcaption>
      </td>
      <td>
        <img src="images/bestfox4.png" align="middle" width="300px"/>
        <figcaption align="middle">Final Iteration Produced</figcaption>
      </td>
    </tr>
  </table>
</div>
<p>
  We can see that from the above results, a lower learning rate does not allow the model enough iterations to learn the full image function. 
  Likewise, less frequency layers means the model has more trouble generating sharper edges and high frequencies in the image function.
  In general, when the hyperparameter L is smaller, the image has more blur and in general, a smoother appearence. When both learning rate and L are small, the results are the poorest.
</p>
<br>
<p>
  Here is a picture of the original fox photo, as well as the best output picture my model learned after 1500 iterations with the optimal hyperparameters, and the PSNR values over time.
</p>
<div align="middle">
  <table style="width=100%">
  <tr>
      <td>
      <img src="images/og_fox.jpg" align="middle" width="300px"/>
      <figcaption align="middle">Original Fox Photo</figcaption>
      </td>
      <td>
        <img src="images/bestfox.png" align="middle" width="300px"/>
        <figcaption align="middle">Best Fox Output From Above</figcaption>
      </td>
      <td>
        <img src="images/fox_PSNR.png" align="middle" width="300px"/>
        <figcaption align="middle">PSNR Graph</figcaption>
      </td>
  </tr>
  </table>
</div>
<p>
  I trained another image network, this time on a beaver! The bottom shows the original beaver photo, the best one generated by my model, and then a PSNR graph as well as intermediate iteractions.
</p>
<div align="middle">
  <table style="width=100%">
  <tr>
      <td>
      <img src="images/beaver_iters.png" align="middle" width="900px"/>
      <figcaption align="middle">Beaver Training Iterations</figcaption>
      </td>
  </tr>
  </table>
</div>
<div align="middle">
  <table style="width=100%">
  <tr>
      <td>
      <img src="images/Beaver.jpg" align="middle" width="300px"/>
      <figcaption align="middle">Original Beaver Photo</figcaption>
      </td>
      <td>
        <img src="images/bestbeaver.png" align="middle" width="300px"/>
        <figcaption align="middle">Best Beaver Output From Above</figcaption>
      </td>
      <td>
        <img src="images/beaver_psnr.png" align="middle" width="300px"/>
        <figcaption align="middle">PSNR Graph</figcaption>
      </td>
  </tr>
  </table>
</div>




<h2 align="middle">Part 2: Neural Radiance Fields (3D)</h2>
<p> 
    In this part, I began by implementing pixel_to_camera and then pixel_to_ray, methods which allow me to obtain the rays from an image and then trace them out into the scene. 
    By estimating their color through a volume rendering function, we were able to compare the ray color to the actual pixel in the image, which allowed us to backprop and have the model learn the scene.
    Then, I settled on the model architecture described in the NeRF paper and generated the rays with perturbed points with my RaysData implementation. 
    Below are some pictures of the Rays Dataset and images describing my implementation.
</p>  
  
<div align="middle">
    <table style="width=100%">
      <tr>
        <td>
        <img src="images/nerf-model-arch.png" align="middle" width="750px"/>
        <figcaption align="middle">NeRF Model Architecture</figcaption>
        </td>
    </tr>
    <tr>
        <td>
        <img src="images/sample_rays.png" align="middle" width="750px"/>
        <figcaption align="middle">3D model of 100 randomly sampled rays from the cameras</figcaption>
        </td>
    </tr>
    </table>
</div>
<br>
<p>
  Once I was able to construct the RaysData which returned the rays constructed in the sphere image and retrieved their colors as labels, I had a valid dataset to train on.
  I then sampled 10,000 rays and their corresponding pixel value and fed that as a batch into the NeRF model. I continued training below to get the following results. 
  I didn't have enough time to train longer as I ran out of GPU credits but I believe I could've achieved above 23 easily if I had trained with more iterations.
  I used a learning rate of 5e-4, 1000 gradient steps, and 10 frequency layers for the position and 4 frequency layers for the ray direction.
</p>
<br>
<p>
  Below shows the validation images while training and their respective PSNR values.
</p>
<div align="middle">
  <table style="width=100%">
    <tr>
      <td>
        <img src="images/validation100.png" align="middle" width="900px"/>
        <figcaption align="middle">After 500 iterations, PSNR of 16</figcaption>
      </td>
    </tr>
    <tr>
      <td>
        <img src="images/validation200.png" align="middle" width="900px"/>
        <figcaption align="middle">After 200 iterations, PSNR of 18</figcaption>
      </td>
    </tr>
  <tr>
    <td>
      <img src="images/validation500.png" align="middle" width="900px"/>
      <figcaption align="middle">After 500 iterations, PSNR of 20</figcaption>
    </td>
  </tr>
  <tr>
      <td>
      <img src="images/validation1000.png" align="middle" width="900px"/>
      <figcaption align="middle">Validation Images after 1000 iterations with a PSNR of 22</figcaption>
      </td>
  </tr>
  </table>
</div>
<br>
<br>
<div align="middle">
  <table style="width=100%">
  <tr>
      <td>
      <img src="images/psnr_final.png" align="middle" width="600px"/>
      <figcaption align="middle">Graph of PSNR vs. Iteractions</figcaption>
      </td>
  </tr>
  </table>
</div>
<br>
<br>
<div align="middle">
  <table style="width=100%">
  <tr>
      <td>
      <img src="images/lego1.gif" align="middle" width="330px"/>
      <figcaption align="middle">After 500 iterations, PSNR of 14</figcaption>
      </td>
      <td>
      <img src="images/lego_bulldozer.gif" align="middle" width="330px"/>
      <figcaption align="middle">After 750 iterations, PSNR of 20</figcaption>
      </td>
      <td>
        <img src="images/lego3.gif" align="middle" width="330px"/>
        <figcaption align="middle">After 1000 iterations, PSNR of 22</figcaption>
        </td>
  </tr>
  </table>
</div>

<h2 align="middle">Bells and Whistles</h2>
<p> I made a custom nerf with nerf studio, it is a scene of a basket with some chopsticks inside a restaurant, and I think it turned out kinda blurry cause of my poor capturing skills.</p>
<div align="middle">
  <table style="width=100%">
  <tr>
      <td>
      <img src="images/nerfstudio.gif" align="middle" width="450px"/>
      <figcaption align="middle">Nerf Studio Render</figcaption>
      </td>
  </tr>
  </table>
</div>
</body>
</html>